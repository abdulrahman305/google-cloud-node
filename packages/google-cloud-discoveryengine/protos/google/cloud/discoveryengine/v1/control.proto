// Copyright 2024 Google LLC
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

syntax = "proto3";

package google.cloud.discoveryengine.v1;

import "google/api/field_behavior.proto";
import "google/api/resource.proto";
import "google/cloud/discoveryengine/v1/common.proto";
import "google/protobuf/timestamp.proto";

option csharp_namespace = "Google.Cloud.DiscoveryEngine.V1";
option go_package = "cloud.google.com/go/discoveryengine/apiv1/discoveryenginepb;discoveryenginepb";
option java_multiple_files = true;
option java_outer_classname = "ControlProto";
option java_package = "com.google.cloud.discoveryengine.v1";
option objc_class_prefix = "DISCOVERYENGINE";
option php_namespace = "Google\\Cloud\\DiscoveryEngine\\V1";
option ruby_package = "Google::Cloud::DiscoveryEngine::V1";

// Defines circumstances to be checked before allowing a behavior
message Condition {
  // Matcher for search request query
  message QueryTerm {
    // The specific query value to match against
    //
    // Must be lowercase, must be UTF-8.
    // Can have at most 3 space separated terms if full_match is true.
    // Cannot be an empty string.
    // Maximum length of 5000 characters.
    string value = 1;

    // Whether the search query needs to exactly match the query term.
    bool full_match = 2;
  }

  // Used for time-dependent conditions.
  message TimeRange {
    // Start of time range.
    //
    // Range is inclusive.
    google.protobuf.Timestamp start_time = 1;

    // End of time range.
    //
    // Range is inclusive.
    // Must be in the future.
    google.protobuf.Timestamp end_time = 2;
  }

  // Search only
  // A list of terms to match the query on.
  //
  // Maximum of 10 query terms.
  repeated QueryTerm query_terms = 2;

  // Range of time(s) specifying when condition is active.
  //
  // Maximum of 10 time ranges.
  repeated TimeRange active_time_range = 3;
}

// Defines a conditioned behavior to employ during serving.
// Must be attached to a
// [ServingConfig][google.cloud.discoveryengine.v1.ServingConfig] to be
// considered at serving time. Permitted actions dependent on `SolutionType`.
message Control {
  option (google.api.resource) = {
    type: "discoveryengine.googleapis.com/Control"
    pattern: "projects/{project}/locations/{location}/dataStores/{data_store}/controls/{control}"
    pattern: "projects/{project}/locations/{location}/collections/{collection}/dataStores/{data_store}/controls/{control}"
    pattern: "projects/{project}/locations/{location}/collections/{collection}/engines/{engine}/controls/{control}"
  };

  // Adjusts order of products in returned list.
  message BoostAction {
    // Required. Strength of the boost, which should be in [-1, 1]. Negative
    // boost means demotion. Default is 0.0 (No-op).
    float boost = 1 [(google.api.field_behavior) = REQUIRED];

    // Required. Specifies which products to apply the boost to.
    //
    // If no filter is provided all products will be boosted (No-op).
    // Syntax documentation:
    // https://cloud.google.com/retail/docs/filter-and-order
    // Maximum length is 5000 characters.
    // Otherwise an INVALID ARGUMENT error is thrown.
    string filter = 2 [(google.api.field_behavior) = REQUIRED];

    // Required. Specifies which data store's documents can be boosted by this
    // control. Full data store name e.g.
    // projects/123/locations/global/collections/default_collection/dataStores/default_data_store
    string data_store = 3 [
      (google.api.field_behavior) = REQUIRED,
      (google.api.resource_reference) = {
        type: "di